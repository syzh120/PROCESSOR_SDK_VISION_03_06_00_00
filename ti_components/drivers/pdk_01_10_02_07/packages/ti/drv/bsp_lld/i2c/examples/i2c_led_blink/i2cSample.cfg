/* ========================================================================== */
/*                      CFG script for the I2C sample                         */
/* ========================================================================== */

/* load the required files and packages                                       */
var Task      = xdc.useModule("ti.sysbios.knl.Task");
var BIOS      = xdc.useModule("ti.sysbios.BIOS");
var System    = xdc.useModule("xdc.runtime.System");
var SysStd    = xdc.useModule('xdc.runtime.SysStd');
var cache     = xdc.useModule("ti.sysbios.hal.Cache");
var Timestamp = xdc.useModule("xdc.runtime.Timestamp");
var Hwi       = xdc.useModule('ti.sysbios.hal.Hwi');
var Sem       = xdc.useModule("ti.sysbios.knl.Semaphore");
var Log       = xdc.useModule('xdc.runtime.Log');
var LoggerBuf = xdc.useModule('xdc.runtime.LoggerBuf');
var Memory    = xdc.useModule('xdc.runtime.Memory')
var SysMin    = xdc.useModule('xdc.runtime.SysMin');
var System       = xdc.useModule('xdc.runtime.System');
var Defaults     = xdc.useModule('xdc.runtime.Defaults');
var Main         = xdc.useModule('xdc.runtime.Main');
var Diags        = xdc.useModule('xdc.runtime.Diags');
var GIO          = xdc.useModule('ti.sysbios.io.GIO');
var Core         = xdc.useModule("ti.sysbios.family.arm.ducati.Core");
var Hwi         = xdc.useModule('ti.sysbios.hal.Hwi');
var GateDualCore = xdc.useModule('ti.sysbios.family.arm.ducati.GateDualCore');
var Program      = xdc.useModule("xdc.cfg.Program");
var InitXbar    = xdc.useModule("ti.sysbios.family.shared.vayu.IntXbar");
var CurrentCore  = java.lang.System.getenv("CORE");

Core.id = 0;
if (CurrentCore == "m4video")
{
    Core.id = 1;
    GateDualCore.initGates = true;
}

/* System stack size (used by ISRs and Swis) */
Program.stack = 0x5000;

System.SupportProxy = SysStd;

/*
 * Create and install logger for the whole system
 */
var loggerBufParams = new LoggerBuf.Params();
loggerBufParams.numEntries = 32;
var logger0 = LoggerBuf.create(loggerBufParams);
Defaults.common$.logger = logger0;
Main.common$.diags_INFO = Diags.ALWAYS_ON;

/* Use Semaphore, and Task modules and set global properties */
var Semaphore = xdc.useModule('ti.sysbios.knl.Semaphore');
Program.global.hsi2c_sem0 = Semaphore.create(1);
Program.global.hsi2c_sem1 = Semaphore.create(1);
Program.global.hsi2c_sem2 = Semaphore.create(1);
Program.global.hsi2c_sem3 = Semaphore.create(1);

var iomFxns      = "I2c_IOMFXNS";
var initFxn      = "user_i2c_init";
var deviceParams = "devInitParams";
var deviceId     = 0;

GIO.addDeviceMeta("i2c", iomFxns, initFxn, deviceId, deviceParams);

var task0Params = new Task.Params();
task0Params.instance.name = "task0";
task0Params.stackSize     = 0x2000;
Program.global.task0      = Task.create("&echo", task0Params);

/* configure the required Heap parameters                                     */
var HeapMem = xdc.useModule('ti.sysbios.heaps.HeapMem');
var prms    = new HeapMem.Params;
prms.size = 8192;
var heap = HeapMem.create(prms);

var Memory = xdc.useModule('xdc.runtime.Memory');
Memory.defaultHeapInstance = heap;

/* Configure the .text section to DDR3
 */
if (CurrentCore == "m4video")
{
  Program.sectMap[".text"]  = "VIDEO_M4_CODE_MEM";
  Program.sectMap[".const"] = "VIDEO_M4_DATA_MEM";
  Program.sectMap[".plt"]   = "VIDEO_M4_CODE_MEM";
}
else
{
  Program.sectMap[".text"]  = "APP_CODE_MEM";
  Program.sectMap[".const"] = "APP_CACHED_DATA_MEM";
  Program.sectMap[".plt"]   = "APP_CODE_MEM";
}

