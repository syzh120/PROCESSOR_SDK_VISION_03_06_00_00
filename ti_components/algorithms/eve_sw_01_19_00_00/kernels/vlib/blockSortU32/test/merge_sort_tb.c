/*
*
* Copyright (c) {YEAR} Texas Instruments Incorporated
*
* All rights reserved not granted herein.
*
* Limited License.
*
* Texas Instruments Incorporated grants a world-wide, royalty-free, non-exclusive
* license under copyrights and patents it now or hereafter owns or controls to make,
* have made, use, import, offer to sell and sell ("Utilize") this software subject to the
* terms herein.  With respect to the foregoing patent license, such license is granted
* solely to the extent that any such patent is necessary to Utilize the software alone.
* The patent license shall not apply to any combinations which include this software,
* other than combinations with devices manufactured by or for TI ("TI Devices").
* No hardware patent is licensed hereunder.
*
* Redistributions must preserve existing copyright notices and reproduce this license
* (including the above copyright notice and the disclaimer and (if applicable) source
* code license limitations below) in the documentation and/or other materials provided
* with the distribution
*
* Redistribution and use in binary form, without modification, are permitted provided
* that the following conditions are met:
*
* *       No reverse engineering, decompilation, or disassembly of this software is
* permitted with respect to any software provided in binary form.
*
* *       any redistribution and use are licensed by TI for use only with TI Devices.
*
* *       Nothing shall obligate TI to provide you with source code for the software
* licensed and provided to you in object code.
*
* If software source code is provided to you, modification and redistribution of the
* source code are permitted provided that the following conditions are met:
*
* *       any redistribution and use of the source code, including any resulting derivative
* works, are licensed by TI for use only with TI Devices.
*
* *       any redistribution and use of any object code compiled from the source code
* and any resulting derivative works, are licensed by TI for use only with TI Devices.
*
* Neither the name of Texas Instruments Incorporated nor the names of its suppliers
*
* may be used to endorse or promote products derived from this software without
* specific prior written permission.
*
* DISCLAIMER.
*
* THIS SOFTWARE IS PROVIDED BY TI AND TI'S LICENSORS "AS IS" AND ANY EXPRESS
* OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
* OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED.
* IN NO EVENT SHALL TI AND TI'S LICENSORS BE LIABLE FOR ANY DIRECT, INDIRECT,
* INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING,
* BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
* DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
* OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE
* OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED
* OF THE POSSIBILITY OF SUCH DAMAGE.
*
*/

/*----------------------------------------------------------------------------*/
/* NAME: test_merge_sort.c                                                    */
/*                                                                            */
/* AUTHOR: J.Sankaran                                                         */
/*                                                                            */
/* REVISON HISTORY:                                                           */
/* 04/16/13.........Wrote initial version of code.................J.Sankaran  */
/*                                                                            */
/* DESCRIPTION:                                                               */
/*                                                                            */
/*  The function "test_merge_sort" provides the test code, to validate        */
/*  the execution of the optimized merge sort function on EVE.                */
/*                                                                            */
/* ASSUMPTIONS:                                                               */
/*                                                                            */
/*  This function assumes the number of points to be sorted is a power of 2.  */
/*  Smallest value for the number of points to be sorted is 64 points.        */
/*                                                                            */
/*----------------------------------------------------------------------------*/
/* Texas Instruments Incorporated 2010-2012.                                  */
/*============================================================================*/

/*----------------------------------------------------------------------------*/
/*  Declare prototypes for all header files needed.                           */
/*----------------------------------------------------------------------------*/

#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include "merge_sort.h"
#include "vcop_sort_cn.h"
#include <vcop.h>
#ifdef __ARP32__
#include "GlobalTypes.h"
#include "baseaddress.h"
#include "pcache.h"
#include "sctm.h"
#endif
#include <assert.h>

/*----------------------------------------------------------------------------*/
/*  Declare varying size of MAX_NITEMS based on size of FIXED_XX where XX     */
/*  can vary from 64 to 4096. Note testing has not yet been done for 4096.    */
/*----------------------------------------------------------------------------*/
#define MAX_NITEMS     2048

/*----------------------------------------------------------------------------*/
/*  Define level of debug visibility needed in the application.               */
/*----------------------------------------------------------------------------*/

#define DEBUG_DATA     0
#define PRINT_LEVEL    8
#define PRINT_SORT2    1

#define DEBUG          1

/*----------------------------------------------------------------------------*/
/*  Declare various fixed data sets, of varying sizes to exercice code.       */
/*----------------------------------------------------------------------------*/
#pragma DATA_SECTION (gx, "SRC_MEM");
#pragma DATA_SECTION (gy, "SRC_MEM");
#pragma DATA_SECTION (beg, "SRC_MEM");
#pragma DATA_SECTION (end, "SRC_MEM");


const unsigned int  gx64[64] =
{
        45,  207,  70,  41,   4, 180, 120, 216,
        104, 167, 255,  63,  43, 241, 252, 217,
        122, 150,   9,  44, 165,  87, 116, 100,
        196, 175,  21,  40, 164, 233,  87, 219,
        94,  32, 251,  56, 168,  78, 166,  20,
        147,  37,  86,  36,  68, 223,  89, 141,
        67, 123, 190, 144,  22, 137, 157, 126,
        119, 198,  47,  38, 152, 136, 245, 180
};


const unsigned int  gx128[128] =
{
        45, 207,  70,  41,   4, 180, 120,  216,
        104, 167, 255,  63,  43, 241, 252,  217,
        122, 150,   9,  44, 165,  87, 116,  100,
        196, 175,  21,  40, 164, 233,  87,  219,
        94,  32, 251,  56, 168,  78, 166,   20,
        147,  37,  86,  36,  68, 223,  89,  141,
        67, 123, 190, 144,  22, 137, 157,  126,
        119, 198,  47,  38, 152, 136, 245,  180,
        48, 212,  52, 157,  58,  13,  15,  189,
        47, 161, 247,  15, 217, 104, 244,  217,
        60, 168,  53, 229, 143,  42, 205,  194,
        64, 193, 207,  82, 113, 106, 114,   41,
        35, 176,  91,  27, 163,  42, 130,  136,
        68,  25,  14,  48, 242, 107, 163,  174,
        15, 132, 205,  73, 214, 131,  66,   23,
        231, 163,  57, 147, 115, 198, 230,  241
};


const unsigned int  gx256[256] =
{
        45,  207,   70,   41,   4,  180,  120,  216,
        104,  167,  255,   63,  43,  241,  252,  217,
        122,  150,    9,   44, 165,   87,  116,  100,
        196,  175,   21,   40, 164,  233,   87,  219,
        94,   32,  251,   56, 168,   78,  166,   20,
        147,   37,   86,   36,  68,  223,   89,  141,
        67,  123,  190,  144,  22,  137,  157,  126,
        119,  198,   47,   38, 152,  136,  245,  180,
        48,  212,   52,  157,  58,   13,   15,  189,
        47,  161,  247,   15, 217,  104,  244,  217,
        60,  168,   53,  229, 143,   42,  205,  194,
        64,  193,  207,   82, 113,  106,  114,   41,
        35,  176,   91,   27, 163,   42,  130,  136,
        68,   25,   14,   48, 242,  107,  163,  174,
        15,  132,  205,   73, 214,  131,   66,   23,
        231,  163,   57,  147, 115,  198,  230,  241,
        138,  254,   33,   27,  25,  126,  228,  117,
        142,  198,  135,  133,  88,  221,   36,  230,
        157,   93,   68,   64, 139,   90,   35,   94,
        169,  239,  236,   63, 145,  156,  122,   65,
        23,   24,  114,  235,   6,  242,  145,  238,
        184,  108,  190,  217,  52,  247,   52,   35,
        6,  122,   51,  112, 151,  215,   82,   18,
        245,  126,  210,  148, 149,  102,    6,   35,
        89,  242,  111,  250, 231,  236,  169,  230,
        171,  170,   57,  191, 186,   95,  165,  177,
        174,   36,  129,   97, 138,  120,   69,  228,
        60,   71,  120,   57,  71,  199,  157,  217,
        74,  175,   97,   23,  59,  189,  106,  245,
        208,   68,   91,  145, 205,   95,  117,   95,
        65,  184,  213,   56,   7,  254,  216,   90,
        177,   47,  70,   188, 142,   53,   42,   56
};


const unsigned int  gx512[512] =
{
        45,  207,   70,   41,    4,  180,  120,  216,
        104,  167,  255,   63,   43,  241,  252,  217,
        122,  150,    9,   44,  165,   87,  116,  100,
        196,  175,   21,   40,  164,  233,   87,  219,
        94,   32,  251,   56,  168,   78,  166,   20,
        147,   37,   86,   36,   68,  223,   89,  141,
        67,  123,  190,  144,   22,  137,  157,  126,
        119,  198,   47,   38,  152,  136,  245,  180,
        48,  212,   52,  157,   58,   13,   15,  189,
        47,  161,  247,   15,  217,  104,  244,  217,
        60,  168,   53,  229,  143,   42,  205,  194,
        64,  193,  207,   82,  113,  106,  114,   41,
        35,  176,   91,   27,  163,   42,  130,  136,
        68,   25,   14,   48,  242,  107,  163,  174,
        15,  132,  205,   73,  214,  131,   66,   23,
        231,  163,   57,  147,  115,  198,  230,  241,
        138,  254,   33,   27,   25,  126,  228,  117,
        142,  198,  135,  133,   88,  221,   36,  230,
        157,   93,   68,   64,  139,   90,   35,   94,
        169,  239,  236,   63,  145,  156,  122,   65,
        23,   24,  114,  235,    6,  242,  145,  238,
        184,  108,  190,  217,   52,  247,   52,   35,
        6,  122,   51,  112,  151,  215,   82,   18,
        245,  126,  210,  148,  149,  102,    6,   35,
        89,  242,  111,  250,  231,  236,  169,  230,
        171,  170,   57,  191,  186,   95,  165,  177,
        174,   36,  129,   97,  138,  120,   69,  228,
        60,   71,  120,   57,   71,  199,  157,  217,
        74,  175,   97,   23,   59,  189,  106,  245,
        208,   68,   91,  145,  205,   95,  117,   95,
        65,  184,  213,   56,    7,  254,  216,   90,
        177,   47,   70,  188,  142,   53,   42,   56,
        204,   42,  175,  175,   98,   15,  134,  117,
        85,  116,   28,  112,  163,    9,  227,   95,
        190,  179,   20,  122,   39,   88,   39,  107,
        16,  216,  177,   16,  154,  174,    5,    8,
        56,  132,  214,   10,  135,   85,  122,  163,
        117,   53,  191,   62,  113,  108,  132,   39,
        119,  193,  209,  194,  224,  150,  101,   32,
        100,  109,  116,    7,   11,   93,  135,   96,
        222,  183,   93,  139,  132,   54,  224,  187,
        191,  151,  133,  162,   10,  193,   90,   72,
        28,  201,  197,  137,  105,  210,  170,   50,
        207,  113,  200,  215,   20,   81,  162,    6,
        141,   29,  205,  237,  201,  250,  201,   24,
        87,    5,  103,  253,  137,  148,  234,   83,
        189,  255,   68,  220,  165,   32,  213,  163,
        76,  142,  148,  147,  161,   36,  116,  205,
        26,    4,  163,  127,   65,  255,   18,   79,
        66,  152,  203,  115,  246,  249,   84,  179,
        212,  236,  181,   30,  130,  127,   86,   99,
        123,   96,  167,  170,  127,  172,  225,  240,
        228,   56,   77,  102,   58,   30,  183,   80,
        170,  103,   56,  224,  238,  182,  102,  140,
        71,  131,    7,  195,  100,  195,   12,  234,
        96,   72,  238,  102,  131,  171,   39,  115,
        92,  148,   24,  215,   73,   31,   48,  129,
        33,  205,   13,  217,   70,  113,  177,  154,
        114,   42,   37,   17,  140,  129,   26,  212,
        45,   52,  170,  104,  172,  118,  114,  129,
        135,  139,   43,   90,   47,   38,  190,  222,
        236,  191,   56,  173,  176,  223,  163,   13,
        41,  200,  111,  223,  120,    6,  184,  132,
        10,  114,  162,   42,   76,  174,  119,  199
};


const unsigned int  gx1024[1024] =
{
        45,  207,   70,   41,    4,  180,  120,  216,
        104,  167,  255,   63,   43,  241,  252,  217,
        122,  150,    9,   44,  165,   87,  116,  100,
        196,  175,   21,   40,  164,  233,   87,  219,
        94,   32,  251,   56,  168,   78,  166,   20,
        147,   37,   86,   36,   68,  223,   89,  141,
        67,  123,  190,  144,   22,  137,  157,  126,
        119,  198,   47,   38,  152,  136,  245,  180,
        48,  212,   52,  157,   58,   13,   15,  189,
        47,  161,  247,   15,  217,  104,  244,  217,
        60,  168,   53,  229,  143,   42,  205,  194,
        64,  193,  207,   82,  113,  106,  114,   41,
        35,  176,   91,   27,  163,   42,  130,  136,
        68,   25,   14,   48,  242,  107,  163,  174,
        15,  132,  205,   73,  214,  131,   66,   23,
        231,  163,   57,  147,  115,  198,  230,  241,
        138,  254,   33,   27,   25,  126,  228,  117,
        142,  198,  135,  133,   88,  221,   36,  230,
        157,   93,   68,   64,  139,   90,   35,   94,
        169,  239,  236,   63,  145,  156,  122,   65,
        23,   24,  114,  235,    6,  242,  145,  238,
        184,  108,  190,  217,   52,  247,   52,   35,
        6,  122,   51,  112,  151,  215,   82,   18,
        245,  126,  210,  148,  149,  102,    6,   35,
        89,  242,  111,  250,  231,  236,  169,  230,
        171,  170,   57,  191,  186,   95,  165,  177,
        174,   36,  129,   97,  138,  120,   69,  228,
        60,   71,  120,   57,   71,  199,  157,  217,
        74,  175,   97,   23,   59,  189,  106,  245,
        208,   68,   91,  145,  205,   95,  117,   95,
        65,  184,  213,   56,    7,  254,  216,   90,
        177,   47,   70,  188,  142,   53,   42,   56,
        204,   42,  175,  175,   98,   15,  134,  117,
        85,  116,   28,  112,  163,    9,  227,   95,
        190,  179,   20,  122,   39,   88,   39,  107,
        16,  216,  177,   16,  154,  174,    5,    8,
        56,  132,  214,   10,  135,   85,  122,  163,
        117,   53,  191,   62,  113,  108,  132,   39,
        119,  193,  209,  194,  224,  150,  101,   32,
        100,  109,  116,    7,   11,   93,  135,   96,
        222,  183,   93,  139,  132,   54,  224,  187,
        191,  151,  133,  162,   10,  193,   90,   72,
        28,  201,  197,  137,  105,  210,  170,   50,
        207,  113,  200,  215,   20,   81,  162,    6,
        141,   29,  205,  237,  201,  250,  201,   24,
        87,    5,  103,  253,  137,  148,  234,   83,
        189,  255,   68,  220,  165,   32,  213,  163,
        76,  142,  148,  147,  161,   36,  116,  205,
        26,    4,  163,  127,   65,  255,   18,   79,
        66,  152,  203,  115,  246,  249,   84,  179,
        212,  236,  181,   30,  130,  127,   86,   99,
        123,   96,  167,  170,  127,  172,  225,  240,
        228,   56,   77,  102,   58,   30,  183,   80,
        170,  103,   56,  224,  238,  182,  102,  140,
        71,  131,    7,  195,  100,  195,   12,  234,
        96,   72,  238,  102,  131,  171,   39,  115,
        92,  148,   24,  215,   73,   31,   48,  129,
        33,  205,   13,  217,   70,  113,  177,  154,
        114,   42,   37,   17,  140,  129,   26,  212,
        45,   52,  170,  104,  172,  118,  114,  129,
        135,  139,   43,   90,   47,   38,  190,  222,
        236,  191,   56,  173,  176,  223,  163,   13,
        41,  200,  111,  223,  120,    6,  184,  132,
        10,  114,  162,   42,   76,  174,  119,  199,
        138,  191,  125,    0,  197,   31,  199,   24,
        68,   24,  236,   95,  102,  241,  156,  106,
        192,  216,   48,   77,   79,   58,   16,  192,
        214,  123,   97,  120,   44,  226,    5,  215,
        44,  132,  201,  170,  216,   45,   45,  177,
        160,  226,   84,  163,  205,    6,    1,   99,
        19,  111,   16,  137,   68,  150,   14,   77,
        239,  194,  100,  242,  180,   71,  158,  128,
        93,  119,  131,   66,   26,   25,  158,   25,
        249,  173,   78,  227,   26,   16,   85,  191,
        136,   83,  143,  136,  252,   16,   58,  143,
        251,  130,   83,  134,   18,   94,   10,   50,
        188,    6,  212,  248,  255,  192,  240,  207,
        16,  212,   29,   53,  250,  206,   78,   45,
        23,    1,  120,  199,  246,    5,  140,   40,
        169,  141,   59,  243,   91,  170,  243,   87,
        27,    4,  135,  132,  168,  126,  115,  126,
        181,  209,   33,   93,   53,  240,  235,   41,
        80,  193,   88,    6,  239,   46,   68,  146,
        122,   24,  187,   66,  182,   85,  116,  181,
        11,   49,    7,   97,  200,  160,   74,   27,
        13,  136,  138,  203,   90,   72,  138,  217,
        99,  175,  244,   10,   73,  135,  187,  195,
        135,  137,   69,   73,  128,  231,  177,  199,
        89,  201,   81,   11,  137,  209,  190,    0,
        214,  150,   19,  152,   95,  252,  254,  233,
        33,  206,  189,   89,  111,   66,   64,  197,
        70,   72,   73,   36,  113,  237,  115,   34,
        158,   23,  234,   64,  115,  132,  150,   16,
        175,  160,  180,  133,   72,  174,  165,  106,
        6,   18,   76,  245,   64,  179,  233,   87,
        81,  139,  115,  183,  198,  171,  179,  204,
        187,  254,  215,   57,   81,  104,  109,  206,
        93,  160,   90,  246,  208,  174,  127,  178,
        63,  111,  206,   32,  111,   62,  107,  139,
        43,   33,  223,   42,   97,  200,   59,  158,
        103,  135,  146,  238,   26,  210,    9,  130,
        20,   49,  155,  246,   14,   39,   65,   53,
        173,  233,  133,   22,  235,   69,  239,   99,
        5,   71,   77,  101,  244,  253,   52,  163,
        178,  114,  253,   79,  210,   46,  172,   81,
        182,  225,  112,   46,   23,   76,  111,  104,
        238,  160,   55,  202,   73,   23,  234,  114,
        137,  111,   89,  149,   36,  195,  192,  114,
        137,  195,   95,  131,  115,  105,  112,   96,
        33,  124,  228,  233,  169,  134,  110,  157,
        98,  222,  163,  168,   36,  221,  239,  117,
        153,   19,  174,  161,  178,    0,  143,  142,
        64,   78,   82,   41,  212,   99,  155,  238,
        112,   92,  211,   13,  209,  165,  160,  226,
        50,   38,  255,   81,  134,  136,  139,  243,
        26,  127,   66,  174,  156,  183,  117,  197,
        21,   72,  191,  146,  141,   89,  242,  115,
        66,  181,  152,   30,  140,    9,  113,  219,
        81,   64,  100,   88,   78,  190,   20,  223,
        183,  162,  134,  157,   75,  180,    2,  141,
        182,  210,  209,    3,  222,   87,   20,  193,
        2,  228,  199,   54,  114,  213,  117,  167,
        139,   75,   77,  255,  151,  204,  132,   48,
        171,  220,  158,  132,  175,   59,   17,   97,
        201,  138,  237,  239,  147,  164,  204,   29,
        42,  189,  227,   10,   89,   26,  123,  183,
        130,  199,    5,  251,   26,  144,   79,  130,
        130,  202,  153,   50,  109,  180,  105,   35,
};

const unsigned int  gx2048[2048] =
{
        45,    207,   70,   41,    4,  180,  120,  216,
        104,    167,  255,   63,   43,  241,  252,  217,
        122,    150,    9,   44,  165,   87,  116,  100,
        196,    175,   21,   40,  164,  233,   87,  219,
        94,     32,  251,   56,  168,   78,  166,   20,
        147,     37,   86,   36,   68,  223,   89,  141,
        67,    123,  190,  144,   22,  137,  157,  126,
        119,    198,   47,   38,  152,  136,  245,  180,
        48,    212,   52,  157,   58,   13,   15,  189,
        47,    161,  247,   15,  217,  104,  244,  217,
        60,    168,   53,  229,  143,   42,  205,  194,
        64,    193,  207,   82,  113,  106,  114,   41,
        35,    176,   91,   27,  163,   42,  130,  136,
        68,     25,   14,   48,  242,  107,  163,  174,
        15,    132,  205,   73,  214,  131,   66,   23,
        231,    163,   57,  147,  115,  198,  230,  241,
        138,    254,   33,   27,   25,  126,  228,  117,
        142,    198,  135,  133,   88,  221,   36,  230,
        157,     93,   68,   64,  139,   90,   35,   94,
        169,    239,  236,   63,  145,  156,  122,   65,
        23,     24,  114,  235,    6,  242,  145,  238,
        184,    108,  190,  217,   52,  247,   52,   35,
        6,    122,   51,  112,  151,  215,   82,   18,
        245,    126,  210,  148,  149,  102,    6,   35,
        89,    242,  111,  250,  231,  236,  169,  230,
        171,    170,   57,  191,  186,   95,  165,  177,
        174,     36,  129,   97,  138,  120,   69,  228,
        60,     71,  120,   57,   71,  199,  157,  217,
        74,    175,   97,   23,   59,  189,  106,  245,
        208,     68,   91,  145,  205,   95,  117,   95,
        65,    184,  213,   56,    7,  254,  216,   90,
        177,     47,   70,  188,  142,   53,   42,   56,
        204,     42,  175,  175,   98,   15,  134,  117,
        85,    116,   28,  112,  163,    9,  227,   95,
        190,    179,   20,  122,   39,   88,   39,  107,
        16,    216,  177,   16,  154,  174,    5,    8,
        56,    132,  214,   10,  135,   85,  122,  163,
        117,     53,  191,   62,  113,  108,  132,   39,
        119,    193,  209,  194,  224,  150,  101,   32,
        100,    109,  116,    7,   11,   93,  135,   96,
        222,    183,   93,  139,  132,   54,  224,  187,
        191,    151,  133,  162,   10,  193,   90,   72,
        28,    201,  197,  137,  105,  210,  170,   50,
        207,    113,  200,  215,   20,   81,  162,    6,
        141,     29,  205,  237,  201,  250,  201,   24,
        87,      5,  103,  253,  137,  148,  234,   83,
        189,    255,   68,  220,  165,   32,  213,  163,
        76,    142,  148,  147,  161,   36,  116,  205,
        26,      4,  163,  127,   65,  255,   18,   79,
        66,    152,  203,  115,  246,  249,   84,  179,
        212,    236,  181,   30,  130,  127,   86,   99,
        123,     96,  167,  170,  127,  172,  225,  240,
        228,     56,   77,  102,   58,   30,  183,   80,
        170,    103,   56,  224,  238,  182,  102,  140,
        71,    131,    7,  195,  100,  195,   12,  234,
        96,     72,  238,  102,  131,  171,   39,  115,
        92,    148,   24,  215,   73,   31,   48,  129,
        33,    205,   13,  217,   70,  113,  177,  154,
        114,     42,   37,   17,  140,  129,   26,  212,
        45,     52,  170,  104,  172,  118,  114,  129,
        135,    139,   43,   90,   47,   38,  190,  222,
        236,    191,   56,  173,  176,  223,  163,   13,
        41,    200,  111,  223,  120,    6,  184,  132,
        10,    114,  162,   42,   76,  174,  119,  199,
        138,    191,  125,    0,  197,   31,  199,   24,
        68,     24,  236,   95,  102,  241,  156,  106,
        192,    216,   48,   77,   79,   58,   16,  192,
        214,    123,   97,  120,   44,  226,    5,  215,
        44,    132,  201,  170,  216,   45,   45,  177,
        160,    226,   84,  163,  205,    6,    1,   99,
        19,    111,   16,  137,   68,  150,   14,   77,
        239,    194,  100,  242,  180,   71,  158,  128,
        93,    119,  131,   66,   26,   25,  158,   25,
        249,    173,   78,  227,   26,   16,   85,  191,
        136,     83,  143,  136,  252,   16,   58,  143,
        251,    130,   83,  134,   18,   94,   10,   50,
        188,      6,  212,  248,  255,  192,  240,  207,
        16,    212,   29,   53,  250,  206,   78,   45,
        23,      1,  120,  199,  246,    5,  140,   40,
        169,    141,   59,  243,   91,  170,  243,   87,
        27,      4,  135,  132,  168,  126,  115,  126,
        181,    209,   33,   93,   53,  240,  235,   41,
        80,    193,   88,    6,  239,   46,   68,  146,
        122,     24,  187,   66,  182,   85,  116,  181,
        11,     49,    7,   97,  200,  160,   74,   27,
        13,    136,  138,  203,   90,   72,  138,  217,
        99,    175,  244,   10,   73,  135,  187,  195,
        135,    137,   69,   73,  128,  231,  177,  199,
        89,    201,   81,   11,  137,  209,  190,    0,
        214,    150,   19,  152,   95,  252,  254,  233,
        33,    206,  189,   89,  111,   66,   64,  197,
        70,     72,   73,   36,  113,  237,  115,   34,
        158,     23,  234,   64,  115,  132,  150,   16,
        175,    160,  180,  133,   72,  174,  165,  106,
        6,     18,   76,  245,   64,  179,  233,   87,
        81,    139,  115,  183,  198,  171,  179,  204,
        187,    254,  215,   57,   81,  104,  109,  206,
        93,    160,   90,  246,  208,  174,  127,  178,
        63,    111,  206,   32,  111,   62,  107,  139,
        43,     33,  223,   42,   97,  200,   59,  158,
        103,    135,  146,  238,   26,  210,    9,  130,
        20,     49,  155,  246,   14,   39,   65,   53,
        173,    233,  133,   22,  235,   69,  239,   99,
        5,     71,   77,  101,  244,  253,   52,  163,
        178,    114,  253,   79,  210,   46,  172,   81,
        182,    225,  112,   46,   23,   76,  111,  104,
        238,    160,   55,  202,   73,   23,  234,  114,
        137,    111,   89,  149,   36,  195,  192,  114,
        137,    195,   95,  131,  115,  105,  112,   96,
        33,    124,  228,  233,  169,  134,  110,  157,
        98,    222,  163,  168,   36,  221,  239,  117,
        153,     19,  174,  161,  178,    0,  143,  142,
        64,     78,   82,   41,  212,   99,  155,  238,
        112,     92,  211,   13,  209,  165,  160,  226,
        50,     38,  255,   81,  134,  136,  139,  243,
        26,    127,   66,  174,  156,  183,  117,  197,
        21,     72,  191,  146,  141,   89,  242,  115,
        66,    181,  152,   30,  140,    9,  113,  219,
        81,     64,  100,   88,   78,  190,   20,  223,
        183,    162,  134,  157,   75,  180,    2,  141,
        182,    210,  209,    3,  222,   87,   20,  193,
        2,    228,  199,   54,  114,  213,  117,  167,
        139,     75,   77,  255,  151,  204,  132,   48,
        171,    220,  158,  132,  175,   59,   17,   97,
        201,    138,  237,  239,  147,  164,  204,   29,
        42,    189,  227,   10,   89,   26,  123,  183,
        130,    199,    5,  251,   26,  144,   79,  130,
        130,    202,  153,   50,  109,  180,  105,   35,
        113,     22,  164,   56,  239,   49,  106,   98,
        139,    218,   20,  226,  253,    5,  163,  178,
        186,    164,   34,   43,  152,  102,   54,  179,
        227,     20,  164,  170,    3,   94,   74,  116,
        211,    180,  176,  106,  139,    5,   23,   26,
        146,    230,  217,  153,  166,   14,  114,   77,
        156,     82,  252,   89,   65,   28,   30,  132,
        83,     61,   66,  161,  234,  247,    5,   23,
        159,    200,  225,  253,   66,  171,   43,  161,
        143,    240,  198,  158,  203,   40,  237,   45,
        127,    204,   30,  248,   19,  218,  231,   51,
        254,    113,  129,  251,  195,  110,  149,   75,
        145,    106,   28,  145,   19,  165,  131,   63,
        251,    179,   49,  236,  188,  232,  170,  199,
        167,    169,  193,  227,   72,   18,   67,   26,
        123,     80,   47,   76,  117,  143,   51,   46,
        253,    241,   74,   41,   12,  211,  218,   73,
        187,    232,  239,   15,   70,  189,  233,   55,
        86,     38,   61,   25,  183,  111,  137,   78,
        144,    191,   20,   85,   91,  179,  234,   22,
        78,    134,   83,  110,   40,  229,   25,   61,
        106,    148,    7,   27,   88,   21,  169,   37,
        200,     58,  132,  124,   62,  195,  141,   61,
        254,    181,   35,  127,  100,  106,   51,  242,
        148,    174,   15,  236,   62,  200,  180,  223,
        159,     83,  102,  174,  171,  144,  189,  158,
        62,    157,  149,  143,   36,  243,  118,   77,
        66,     10,  179,   94,   60,   48,  130,  166,
        4,    219,   65,   77,  223,   23,  250,   91,
        47,    170,  154,  240,  103,   46,  229,  247,
        2,    220,  245,   51,  127,  231,  146,  117,
        92,     65,  181,   42,  113,   19,  230,  108,
        128,    247,  139,  152,   67,  130,  112,   96,
        118,     83,  133,  140,  201,  120,  224,  164,
        112,     99,   30,  102,  159,  118,   47,  226,
        149,     92,  233,   65,  153,  102,  150,   46,
        28,    244,   97,  115,   40,   66,   34,   62,
        156,    136,   18,  176,  202,  183,  133,   29,
        249,    142,  255,    3,  110,   86,  112,  144,
        71,    165,   19,  163,  119,  111,  141,  233,
        168,     89,    6,   92,  192,  135,  253,    4,
        222,     87,  237,   13,  196,   24,  217,  185,
        40,    179,  105,  123,  219,   10,   32,  234,
        160,    128,   52,  111,   37,   17,   30,    4,
        47,    211,  123,  231,  142,  226,   35,  161,
        207,    237,   56,  210,   22,  225,   34,  140,
        173,     53,  138,  152,   61,  206,  142,  103,
        107,     54,  190,  100,   54,  127,  138,  182,
        131,    188,  120,    1,   86,  181,   66,  253,
        159,    226,   66,  173,  208,  157,    0,   68,
        94,    142,  100,   55,  183,  135,   93,   42,
        210,    194,  201,   94,  218,  232,  150,   94,
        194,    177,   98,   42,  248,  163,  233,   27,
        103,    138,   59,  196,   82,   73,  131,    8,
        63,     96,   60,    9,  164,  177,   93,  158,
        41,    164,   75,  208,   13,   34,   33,  228,
        216,     28,   65,  179,   95,  252,  224,   54,
        102,     66,  237,  187,  246,  131,   62,   89,
        138,    127,   26,   80,  249,   73,   97,   19,
        176,    170,   79,   74,  179,   93,  185,   21,
        11,    194,  182,  253,  101,   41,  122,  221,
        78,    190,  110,  170,  182,  182,   98,  233,
        175,      4,   55,  156,  170,  195,   22,   96,
        90,    194,   39,  238,  194,  207,   52,    3,
        123,     80,  241,  184,  179,   31,  239,   20,
        135,     88,  220,   32,  209,   78,  206,  129,
        97,     87,  117,  139,   20,  239,  212,  126,
        149,    196,  165,  245,  107,   97,   66,   99,
        173,    237,  166,   31,  177,  201,  178,  112,
        116,     91,   11,   30,  111,  221,   41,  216,
        153,     63,  216,  134,   94,  237,  122,   37,
        13,     66,   80,   42,   60,   92,    7,  231,
        15,    197,    3,   54,   98,  119,  195,   54,
        188,     85,   66,   23,   77,   81,  249,  117,
        154,    239,  249,  124,  229,   26,   66,  110,
        116,     88,  156,  104,   69,   29,  175,  163,
        125,    149,  170,   11,   82,   77,    9,  120,
        142,     96,  238,  237,   92,   29,  180,  142,
        250,     22,  123,  167,  156,  252,  148,  109,
        71,    118,   27,   24,   67,  186,    1,  101,
        199,     63,  161,  239,  119,  176,  165,   53,
        231,    119,   88,  241,  108,  105,  219,  225,
        168,    233,  135,   66,  118,   50,  226,  208,
        150,     49,  186,  175,  194,  183,  252,   20,
        59,     82,   75,  186,   25,  178,   76,  115,
        217,    188,   90,  222,  207,   65,   13,  151,
        238,     53,   57,   78,  201,   96,  120,  128,
        197,     15,  241,   46,   69,  179,  103,   18,
        36,    156,   94,    4,  184,  135,  153,   98,
        209,    205,   24,  216,    0,  192,   32,   33,
        125,    109,   30,   75,  184,   33,   85,   59,
        90,     87,  252,  158,  105,   19,  105,  149,
        87,    182,  219,  102,  242,  234,  100,  119,
        218,     14,  180,  107,   75,   65,   50,   18,
        111,    179,  166,  249,  149,  238,    1,   52,
        187,    222,   16,  141,   16,  178,   31,    8,
        181,    145,  254,  180,  103,  145,   27,  138,
        231,    248,    4,  136,  112,  138,  196,    4,
        76,    235,  153,   19,   73,   20,   98,  176,
        249,    212,  146,  142,  130,  142,   51,  103,
        177,      7,   59,   65,  163,  152,   18,  246,
        25,    102,   73,  133,   73,  254,  207,  111,
        20,    202,  147,   18,  187,  156,  147,  165,
        146,    148,   75,  183,  151,  120,  112,  160,
        217,    105,   46,   26,  255,  243,  224,  179,
        1,    229,  226,   21,  115,  200,  214,  139,
        67,    221,  113,  228,   51,   61,  186,   88,
        62,    113,  160,   29,  217,  193,   91,  237,
        87,      8,  152,   65,  140,  215,  175,  122,
        234,      2,    8,   81,  241,    9,    1,   46,
        215,    159,  207,  177,  193,   71,  221,  250,
        172,    130,  200,   85,  174,  230,  196,   55,
        124,    201,   75,  240,  247,   41,  149,  220,
        27,    148,  125,  168,  213,    6,   51,  168,
        83,    130,  121,  149,  167,  146,  184,   72,
        79,    117,    1,  240,  123,   66,   97,  109,
        68,    176,   44,  212,  107,  241,  236,  103,
        34,     16,   71,  235,  226,   90,   25,  163,
        204,    254,  228,   93,  184,  109,  149,   37,
        32,     88,  197,  249,  204,  183,   97,  233,
        219,    109,   29,   78,  127,  193,  161,  191,
        24,    211,  100,   64,   53,   29,   74,  255,
        232,    161,  163,   74,  196,  140,   30,   61,
        102,    106,    2,  114,  121,   98,    6,  203,
        37,    238,  253,  171,   21,   39,  148,  189,
        226,    112,  127,   38,  234,   25,   85,  179,
        233,     27,  220,  201,  250,  243,   56,  160,
        124,    230,   81,  213,  204,   66,   51,   87
};

const unsigned int *gx[]={gx64, gx128, gx256, gx512, gx1024, gx2048};

unsigned int  gy[MAX_NITEMS];

int32_t beg[1000];
int32_t end[1000];

#pragma DATA_SECTION(bufa,       "Adata");
#pragma DATA_SECTION(bufb,       "Bdata");

int     bufa[MAX_NITEMS * 9/8];
int     bufb[MAX_NITEMS * 9/8];

#pragma DATA_SECTION(out_offset, "Cdata");
#pragma DATA_ALIGN(out_offset, __ALIGNOF__(int));
int     out_offset[8 * MAX_FUNC_CALLS];

#pragma DATA_SECTION(__my_pblock, ".vcop_parameter_block")
#pragma DATA_ALIGN(__my_pblock, __ALIGNOF__(int));
unsigned short __my_pblock[MAX_PARAMS];

/*----------------------------------------------------------------------------*/
/* Prototype various functions, we plan to call.                              */
/*----------------------------------------------------------------------------*/

extern void sort_eve_v06(int n, int *x);
extern void print_arr(int width, int height, int *x, char *tag);

/*----------------------------------------------------------------------------*/
/* Main function, which varies "N" based on the size of the FIXED_XX macro.   */
/* converts argv to an integer, then calls sort function, to implement        */
/* sorting. A minimal check is made to sure, elements are in ascending        */
/* order.                                                                     */
/*----------------------------------------------------------------------------*/

int main()
{
    int t, i, err = 0;
    int nitems;

    int32_t status= 0;

    SortContext c;

    unsigned int sctm_t1, sctm_t2, exec_diff;
    unsigned int overflow;
    EVE_SCTM_Enable(CTM);
    EVE_SCTM_CounterConfig(CTM, SCTM_Counter_0, VCOP_BUSY, SCTM_DURATION);

    for (t=0; t < 6; t++) {

        nitems= (1<<(6+t));

        memcpy(gy, gx[t], 4*nitems);

        c.my_pblock_ptr      =  &__my_pblock[0];
        c.my_out_offset_ptr  =  (int32_t (*)[])&out_offset[0];
        c.backup_my_pblock_ptr      =  &__my_pblock[0];
        c.backup_my_out_offset_ptr  =  (int32_t (*)[])&out_offset[0];
        c.num_funcs_exec     =  0;

        VCOP_BUF_SWITCH_SET(WBUF_SYST, IBUFHB_SYST, IBUFLB_SYST, IBUFHA_SYST, IBUFLA_SYST);

        for (i=0; i<nitems; i++) bufa[i] = gx[t][i];

        status= mergeSort_init(bufa, bufb, bufb, nitems, &c);
        assert(status==0);

        VCOP_BUF_SWITCH_SET(WBUF_VCOP, IBUFHB_VCOP, IBUFLB_VCOP, IBUFHA_VCOP, IBUFLA_VCOP);

        /* To compensate for cash misses, we run the sorting twice and only measure the second run */

        for (i=0;i<c.num_funcs_exec; i++) {
            c.funcs_exec[i](c.ptr_params[i]);
        }

        _vcop_vloop_done();

        /* Copy back original data before running second time */
        VCOP_BUF_SWITCH_SET(WBUF_SYST, IBUFHB_SYST, IBUFLB_SYST, IBUFHA_SYST, IBUFLA_SYST);
        for (i=0; i<nitems; i++) bufa[i] = gx[t][i];
        VCOP_BUF_SWITCH_SET(WBUF_VCOP, IBUFHB_VCOP, IBUFLB_VCOP, IBUFHA_VCOP, IBUFLA_VCOP);

        EVE_SCTM_CounterTimerEnable(CTM, SCTM_Counter_0);
        sctm_t1 = EVE_SCTM_CounterRead (CTM, SCTM_Counter_0);

        for (i=0;i<c.num_funcs_exec; i++) {
            c.funcs_exec[i](c.ptr_params[i]);
        }

        _vcop_vloop_done();

        sctm_t2 = EVE_SCTM_CounterRead (CTM, SCTM_Counter_0);
        overflow= EVE_SCTM_OverflowCheck(CTM,SCTM_Counter_0);
        assert(overflow!=1);

        VCOP_BUF_SWITCH_SET(WBUF_SYST, IBUFHB_SYST, IBUFLB_SYST, IBUFHA_SYST, IBUFLA_SYST);

        exec_diff = sctm_t2 - sctm_t1;
        EVE_SCTM_CounterTimerDisable(CTM, SCTM_Counter_0);

        vcop_sort_cn(nitems, gy, beg, end);

        err = 0;
        for (i=0;i<nitems;i++)
            err += (bufb[i] != gy[i]);

        if (err )
            printf("N = %d Test failed; number of mis-orderings = %d\n", nitems, err);
        else
            printf("N = %d Test passed %2.2f VCOP cyc/point\n", nitems, 2.0*exec_diff/nitems);
    }

}


/*----------------------------------------------------------------------------*/
/* End of file:  test_merge_sort.c                                            */
/*----------------------------------------------------------------------------*/
/* Texas Instruments Incorporated 2010-2012.                                  */
/*============================================================================*/


