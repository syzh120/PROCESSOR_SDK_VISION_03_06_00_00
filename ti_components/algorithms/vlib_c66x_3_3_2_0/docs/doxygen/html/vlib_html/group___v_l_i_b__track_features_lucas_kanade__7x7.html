<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>VLIB: VLIB_trackFeaturesLucasKanade_7x7</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<table width=100%>
<tr>
  <td bgcolor="black" width="1"><a href="http://www.ti.com"><img border=0 src="tilogo.gif"></a></td>
  <td bgcolor="red"><img src="titagline.gif"></td>
</tr>
</table>
<!-- Generated by Doxygen 1.5.1-p1 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
  </ul></div>
<h1>VLIB_trackFeaturesLucasKanade_7x7</h1><hr><a name="_details"></a><h2>Detailed Description</h2>

<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int32_t&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group___v_l_i_b__track_features_lucas_kanade__7x7.html#g29b433196b1fc82f03b249705bab2d3f">VLIB_trackFeaturesLucasKanade_7x7</a> (const uint8_t im1[restrict], const uint8_t im2[restrict], const int16_t gradX[restrict], const int16_t gradY[restrict], uint16_t width, uint16_t height, uint32_t nfeatures, const uint16_t x[restrict], const uint16_t y[restrict], uint16_t outx[restrict], uint16_t outy[restrict], uint16_t error[restrict], uint32_t max_iters, uint32_t earlyExitTh, uint8_t scratch[restrict])</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="g29b433196b1fc82f03b249705bab2d3f"></a><!-- doxytag: member="c66/VLIB_trackFeaturesLucasKanade_7x7.h::VLIB_trackFeaturesLucasKanade_7x7" ref="g29b433196b1fc82f03b249705bab2d3f" args="(const uint8_t im1[restrict], const uint8_t im2[restrict], const int16_t gradX[restrict], const int16_t gradY[restrict], uint16_t width, uint16_t height, uint32_t nfeatures, const uint16_t x[restrict], const uint16_t y[restrict], uint16_t outx[restrict], uint16_t outy[restrict], uint16_t error[restrict], uint32_t max_iters, uint32_t earlyExitTh, uint8_t scratch[restrict])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int32_t VLIB_trackFeaturesLucasKanade_7x7           </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&nbsp;</td>
          <td class="paramname"> <em>im1</em>[restrict], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint8_t&nbsp;</td>
          <td class="paramname"> <em>im2</em>[restrict], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int16_t&nbsp;</td>
          <td class="paramname"> <em>gradX</em>[restrict], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const int16_t&nbsp;</td>
          <td class="paramname"> <em>gradY</em>[restrict], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>height</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>nfeatures</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint16_t&nbsp;</td>
          <td class="paramname"> <em>x</em>[restrict], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const uint16_t&nbsp;</td>
          <td class="paramname"> <em>y</em>[restrict], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>outx</em>[restrict], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>outy</em>[restrict], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&nbsp;</td>
          <td class="paramname"> <em>error</em>[restrict], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>max_iters</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint32_t&nbsp;</td>
          <td class="paramname"> <em>earlyExitTh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&nbsp;</td>
          <td class="paramname"> <em>scratch</em>[restrict]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b>Description</b></dt><dd>This function considers a 7x7 patch centered about the feature coordinate. Bilinear sampling is used so that the tracked feature coordinates have sub-pixel accuracy. The number of iterations typically can be between 6 and 10. This API also calculates transaltion error ( sum of the absolute difference ) between two frames.</dd></dl>
The error contains the sum of absolute differences between the window in im1 around (x,y) and the window in im2 around (outx,outy). Window size is equal to patch size. This error can be used to discard features whose track_error exceeds a user defined threshold. For features that have moved very close to the borders of the image, error value returned is 65535. The algorithm is inverse compositional.<p>
<dl class="user" compact><dt><b></b></dt><dd></dd></dl>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>im1[]</em>&nbsp;</td><td>Input Luma image 1,typically points to previous frame where feature locations are known. (UQ8.0) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>im2[]</em>&nbsp;</td><td>Input Luma image 2,typically points to current frame where tracked location of feature points needs to be evaluated. (UQ8.0) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>gradX[]</em>&nbsp;</td><td>X gradient of im1. If this parameter is passed as NULL then gradient is calculate inside the kernel.If is provided by user then its buffer pitch should be same input image and that is equal to width(SQ15.0) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>gradY[]</em>&nbsp;</td><td>Y gradient of im1. If this parameter is passed as NULL then gradient is calculate inside the kernel.If is provided by user then its buffer pitch should be same input image and that is equal to width(SQ15.0) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>width</em>&nbsp;</td><td>Image width (UQ16.0) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>height</em>&nbsp;</td><td>Image height (UQ16.0) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>nfeatures</em>&nbsp;</td><td>Number of features. It should be multiple of two (UQ32.0) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>x[]</em>&nbsp;</td><td>X feature coordinates in im1 (UQ12.4) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>y[]</em>&nbsp;</td><td>Y feature coordinates in im1 (UQ12.4) </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>outx[]</em>&nbsp;</td><td>X feature coordinates in im2, user has to provide initial estimate of the location in current frame. In normal situation user can set this as same as previous frame location. If a feature goes out of boundary then its value is set to -1 (ie. 0xFFFFU). (UQ12.4) </td></tr>
    <tr><td valign="top"><tt>[in,out]</tt>&nbsp;</td><td valign="top"><em>outy[]</em>&nbsp;</td><td>Y feature coordinates in im2user has to provide initial estimate of the location in current frame. In normal situation user can set this as same as previous frame location. If a feature goes out of boundary then its value is set to -1. (ie. 0xFFFFU). (UQ12.4) </td></tr>
    <tr><td valign="top"><tt>[out]</tt>&nbsp;</td><td valign="top"><em>error[]</em>&nbsp;</td><td>Pure translational error for each feature point. If this pointer is provided as NULL then no error calculation will be done, and less cycle will be consumed inside the kernel. (UQ16.0) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>max_iters</em>&nbsp;</td><td>Maximum number of iterations (UQ32.0) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>earlyExitTh</em>&nbsp;</td><td>Threshold for exiting the iteration loop. if sum of the absolute differences of flow vectors in x and y direction is less than this threshold then iteration loop is terminated. For no termination this threshold can be set to zero (UQ32.0) </td></tr>
    <tr><td valign="top"><tt>[in]</tt>&nbsp;</td><td valign="top"><em>scratch[]</em>&nbsp;</td><td>Scratch memory. It is always good to allocate scratch buffer in L1D. Total size of the scratch buffer required is 839 (UQ8.0)</td></tr>
  </table>
</dl>
<dl class="user" compact><dt><b>Assumptions</b></dt><dd><ul>
<li>The input pointer 'scratch' should be pointing at a memory buffer of 839 bytes. It should ideally be located in on-chip memory.</li><li>The parameters outx and outy are expected to contain initial estimates of feature coordinates in im2. The function will overwrite these values with refined values. If initial estimates are not known, they should typically be equal to feature coordinates of im1 (i.e. parameter x &amp; y).</li><li>The parameters x, y, outx and outy are expected to be in Q12.4 format. So, the pixel level coordinates should be left shifted by four before passing them to the function.</li><li>No feature coordinates are rejected, so the length of outputs outx and outy is same as the length of inputs x and y.</li><li>Number of features should be multiple of two.</li><li>Return value from this function is total number of internal loop execution. If any un-valid parameter is passed to this kernel then this value returned will be zero. In no early exit scenario, this value will be equal to max_iters*nfeatures. If there is early exit for some features, this value will be between nfeatures &lt;= value &lt; max_iters*nfeatures. This information can be used to help aid in performance reporting and the adjustment of the setting of the max_iters paramter.</li></ul>
</dd></dl>
<dl class="user" compact><dt><b>Benchmarks:</b></dt><dd>See VLIB_Test_Report.html for cycle and memory information. </dd></dl>

</div>
</div><p>
<hr size="1"><small>
Copyright  2018, Texas Instruments Incorporated</small>
</body>
</html>
